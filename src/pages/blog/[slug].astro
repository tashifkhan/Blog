---
import Layout from "@/layouts/Layout.astro";
import { getAllPosts, getPostBySlug } from "@/lib/posts";
import { BlogPostWrapper } from "@/components/BlogPostWrapper";
import EngagementPanel from "@/components/EngagementPanel";
import MarkdownRenderer from "@/components/MarkdownRenderer.astro";

export const prerender = true;

export async function getStaticPaths() {
	const posts = await getAllPosts();
	return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug!);

// Parse author info from frontmatter, with fallback to default
const author = post?.frontmatter.author
	? {
			name: post.frontmatter.author,
			bio: "Full-stack developer passionate about modern web technologies and building amazing user experiences",
			socials: post.frontmatter.socials || [
				"https://www.github.com/tashifkhan",
				"https://www.linkedin.com/in/tashif-ahmad-khan-982304244/",
				"https://tashif.codes",
			],
		}
	: {
			name: "Tashif Ahmad Khan",
			bio: "Full-stack developer passionate about modern web technologies and building amazing user experiences",
			socials: [
				"https://www.github.com/tashifkhan",
				"https://www.linkedin.com/in/tashif-ahmad-khan-982304244/",
				"https://tashif.codes",
			],
		};
---

<Layout>
	{
		post ? (
			<BlogPostWrapper
				client:only="react"
				title={post.frontmatter.title}
				date={post.frontmatter.date}
				excerpt={post.frontmatter.excerpt}
				tags={post.frontmatter.tags}
				slug={slug ?? ""}
				author={author}
			>
				<MarkdownRenderer
					content={post.rawContent}
					githubBaseUrl="https://github.com/tashifkhan/Blog"
				/>
				{/* EngagementPanel is rendered inside BlogPostWrapper */}
			</BlogPostWrapper>
		) : (
			<div class="max-w-2xl mx-auto p-8 text-center">Post not found.</div>
		)
	}
</Layout>
